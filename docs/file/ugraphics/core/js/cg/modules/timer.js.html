<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../../">
  <title data-ice="title">ugraphics/core/js/cg/modules/timer.js | ugraphics</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ugraphics/socketHandler.js~socketHandler.html">socketHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-LoadConfig">LoadConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ParseArgs">ParseArgs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Styl">Styl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-router">router</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-app">app</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-io">io</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-logger">logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-server">server</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CWD">CWD</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Config">Config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Debug">Debug</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-argv">argv</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core-js-cg">core/js/cg</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ugraphics/core/js/cg/cgcontroller.js~CGController.html">CGController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cgAnimate">cgAnimate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cgsetup">cgsetup</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core-js-cg-modules">core/js/cg/modules</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-clock">clock</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-timer">timer</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core-js-dash">core/js/dash</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/ugraphics/core/js/dash/dashcontroller.js~DashController.html">DashController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dashsetup">dashsetup</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core-js-dash-modules">core/js/dash/modules</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-queue">queue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-timer">timer</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">ugraphics/core/js/cg/modules/timer.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import $ from &apos;jquery&apos;;
import _ from &apos;lodash&apos;;
import Numeral from &apos;numeral&apos;;

let timers = {};
let elems = {};

let padNum = (num, len) =&gt; {
    return num.toString().padStart(len, &apos;0&apos;);
}

let format = seconds =&gt; {
    if (seconds &lt; 0) seconds *= -1;
    let minutes = Math.floor(seconds/60);
    seconds %= 60;
    return `${padNum(minutes, 2)}:${padNum(seconds, 2)}`;
}

let update = id =&gt; {
    let counter = timers[id].counter;
    if (counter &lt; 0) elems[id].addClass(&apos;timer-negative&apos;);
    else elems[id].removeClass(&apos;timer-negative&apos;);
    elems[id].text(format(counter));
    if (timers[id].lmode == &apos;hard&apos; &amp;&amp; counter == timers[id].limiter) clearInterval(timers[id].cinterval);
    if (counter == timers[id].limiter) elems[id].addClass(&apos;timer-overtime&apos;);
}

let start = id =&gt; {
    if (!timers[id] || timers[id].cinterval) return;
    console.log(`- Timer start ${id}`);
    timers[id].cinterval = setInterval(() =&gt; {
        console.log(`- Timer ctick ${id}, ${timers[id].counter++}`);
        update(id);
    }, 1000);
};

let down = id =&gt; {
    if (!timers[id] || timers[id].cinterval) return;
    console.log(`- Timer down ${id}`);
    timers[id].cinterval = setInterval(() =&gt; {
        console.log(`- Timer dtick ${id}, ${timers[id].counter--}`);
        update(id);
    }, 1000);
}

let set = data =&gt; {
    stop(data.id);
    elems[data.id].removeClass(&apos;timer-overtime timer-negative&apos;);
    timers[data.id] = {
        counter: data.counter || 0,
        direction: data.direction || &apos;up&apos;,
        cinterval: null,
        limiter: data.limiter || null,
        lmode: data.lmode || &apos;soft&apos;
    }
    update(data.id);
};

let lset = data =&gt; {
    if (!timers[data.id]) set(data);
    if (data.limiter &lt; 0) timers[data.id].limiter = null;
    timers[data.id].limiter = data.limiter || timers[data.id].limiter || null;
    timers[data.id].lmode = data.lmode || timers[data.id].lmode || &apos;soft&apos;;
};

let stop = id =&gt; {
    console.log(`- Timer stop ${id}`);
    if (timers[id] &amp;&amp; timers[id].cinterval) {
        clearInterval(timers[id].cinterval);
        timers[id].cinterval = null;
    }
}

let add = data =&gt; {
    if (!timers[data.id]) return;
    console.log(`- Timer add ${data.id}, ${data.counter}`);
    timers[data.id].counter += parseInt(data.counter) || 0;
    update(data.id);
}

export default controller =&gt; {
    console.log(`${controller.name}: timer module`);
    controller.cgTriggerSubscribe(&apos;timer&apos;, data =&gt; {
        elems[data.id] = controller.element.find(`[fg-timer=&apos;${data.id}&apos;]`);
        console.log(`${controller.name}: timer trigger ${JSON.stringify(data)}`);
        switch (data.op) {
            case &apos;start&apos;: start(data.id); break;
            case &apos;set&apos;: set(data); break;
            case &apos;stop&apos;: stop(data.id); break;
            case &apos;down&apos;: down(data.id); break;
            case &apos;add&apos;: add(data); break;
            case &apos;lset&apos;: lset(data); break;
            default: break;
        }
    });
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
